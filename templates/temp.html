<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>

    <title>Weather Application</title>
</head>
<body>
    <div class="weather-card">
        <div class="weather-card-title">
            <h2>Weather Search</h2>
            <h3>Fill out the form to get weather info !</h3>
        </div>
        <div class="weather-card-form">
            <form action="{{ url_for('render_results')}}" method="POST" id="myForm">
                <label for="street" class="required">Street</label>
                <br>
                <input type="text" id="street" name="street" placeholder="Enter Street" required size="50">
                <br>
                <div class="weather-card-form-address weather-card-form-padding-in-between">
                    <div>
                        <label for="city" class="required">City</label>
                        <br>
                        <input type="text" id="city" name="city" placeholder="Enter City" required size="25">
                    </div>
                    <div>
                        <label for="state" class="required">State</label>
                        <br>
                        <select required name="state" id="state">
                            <option disabled selected value> Select State</option>
                            <option value="AL">Alabama</option>
                            <option value="AK">Alaska</option>
                            <option value="AZ">Arizona</option>
                            <option value="AR">Arkansas</option>
                            <option value="CA">California</option>
                            <option value="CO">Colorado</option>
                            <option value="CT">Connecticut</option>
                            <option value="DE">Delaware</option>
                            <option value="DC">District Of Columbia</option>
                            <option value="FL">Florida</option>
                            <option value="GA">Georgia</option>
                            <option value="HI">Hawaii</option>
                            <option value="ID">Idaho</option>
                            <option value="IL">Illinois</option>
                            <option value="IN">Indiana</option>
                            <option value="IA">Iowa</option>
                            <option value="KS">Kansas</option>
                            <option value="KY">Kentucky</option>
                            <option value="LA">Louisiana</option>
                            <option value="ME">Maine</option>
                            <option value="MD">Maryland</option>
                            <option value="MA">Massachusetts</option>
                            <option value="MI">Michigan</option>
                            <option value="MN">Minnesota</option>
                            <option value="MS">Mississippi</option>
                            <option value="MO">Missouri</option>
                            <option value="MT">Montana</option>
                            <option value="NE">Nebraska</option>
                            <option value="NV">Nevada</option>
                            <option value="NH">New Hampshire</option>
                            <option value="NJ">New Jersey</option>
                            <option value="NM">New Mexico</option>
                            <option value="NY">New York</option>
                            <option value="NC">North Carolina</option>
                            <option value="ND">North Dakota</option>
                            <option value="OH">Ohio</option>
                            <option value="OK">Oklahoma</option>
                            <option value="OR">Oregon</option>
                            <option value="PA">Pennsylvania</option>
                            <option value="RI">Rhode Island</option>
                            <option value="SC">South Carolina</option>
                            <option value="SD">South Dakota</option>
                            <option value="TN">Tennessee</option>
                            <option value="TX">Texas</option>
                            <option value="UT">Utah</option>
                            <option value="VT">Vermont</option>
                            <option value="VA">Virginia</option>
                            <option value="WA">Washington</option>
                            <option value="WV">West Virginia</option>
                            <option value="WI">Wisconsin</option>
                            <option value="WY">Wyoming</option>
                        </select>
                    </div>
                </div>
                <div class="weather-card-form-padding-in-between" style="display:flex">
                    <span>Want us to auto-detect your location? Check here</span>
                    <input type="checkbox" id="location" value="location" name="location">
                </div>
                <div class="weather-card-form-padding-in-between">
                    <button type="submit">SUBMIT</button>
                    <button id="form-clear">CLEAR</button>
                </div>
            </form>
        </div>
    </div>

    {% if weather_current %}
    <div class="card">
        <div class="container">
            <p>{{address}}</p>
            {%for interval in weather_current%}

                <div style="display: flex;justify-content: space-between;">
                    <div class="current-weather-details" style="align-items: center;width: 30%;">
                        <img src = "../static/Images/{{weather_codes.get(interval['values']['weatherCode'])[1] }}" style="width: 65%; height: 65%;"/>
                        <p>{{ weather_codes.get(interval['values']['weatherCode'])[0] }}</p>
                    </div>
                    <div style="width: 100%;display: flex;justify-content: center;align-items: center;font-size: 50px;color: grey;">
                        <p>{{ interval['values']['temperature'] }} &#176;</p>
                    </div>
                </div>

                <div style="display: flex;">
                    <div class="current-weather-details">
                        <p>Humidity</p>
                        <img src="https://cdn2.iconfinder.com/data/icons/weather-74/24/weather-16-512.png" alt="Humidity">
                        <p>{{ interval['values']['humidity'] }}</p>
                    </div>
                    <div class="current-weather-details">
                        <p>Pressure</p>
                        <img src="https://cdn2.iconfinder.com/data/icons/weather-74/24/weather-25-512.png" alt="Pressure">
                        <p>{{ interval['values']['pressureSeaLevel'] }}</p>
                    </div>
                    <div class="current-weather-details">
                        <p>Wind Speed</p>
                        <img src="https://cdn2.iconfinder.com/data/icons/weather-74/24/weather-27-512.png" alt="Wind Speed">
                        <p>{{ interval['values']['windSpeed'] }}</p>
                    </div>
                    <div class="current-weather-details">
                        <p>Visibility</p>
                        <img src="https://cdn2.iconfinder.com/data/icons/weather-74/24/weather-30-512.png" alt="Visibility">
                        <p>{{ interval['values']['visibility'] }}</p>
                    </div>
                    <div class="current-weather-details">
                        <p>Cloud Cover</p>
                        <img src="https://cdn2.iconfinder.com/data/icons/weather-74/24/weather-28-512.png" alt="Cloud Cover">
                        <p>{{ interval['values']['cloudCover'] }}</p>
                    </div>
                    <div class="current-weather-details">
                        <p>UV Level</p>
                        <img src="https://cdn2.iconfinder.com/data/icons/weather-74/24/weather-24-512.png" alt="UV Level">
                        <p>{{ interval['values']['uvIndex'] }}</p>
                    </div>
                </div>
            {%endfor%}
        </div>
    </div>
    {% endif %}

    {% if weather_forecast %}
        <div class="card" style="margin-top: 2%; background-color: rgb(79 110 172);">
            <div class="container weather-forecast-card">
                <p style="flex: 2;">Date</p>
                <p>Status</p>
                <p>Temp High</p>
                <p>Temp Low</p>
                <p>Wind Speed</p>
            </div>
        </div>
        {%for interval in weather_forecast%}
            <div class="card" style="margin-top: 0.75%;" onclick = "getDayData('{{ interval.Date }}')">
                <div class="container weather-forecast-card">
                    <div style="flex: 2;">{{ interval['Date'] }}</div>
                    <div style="display: inline-grid;"><img src = "../static/Images/{{weather_codes.get(interval['values']['weatherCode'])[1] }}" style="width: 80%; height: 80%;"/></div>
                    <div>{{ interval['values']['temperatureMax'] }}</div>
                    <div>{{ interval['values']['temperatureMin'] }}</div>
                    <div>{{ interval['values']['windSpeed'] }}</div>
                </div>
            </div>
        {%endfor%}
    {% endif %}

    {% if day_data %}
        <div class="card" style="margin-top: 2%;">
            <div class="container weather-forecast-card">
                <p style="flex: 2;">Date</p>
                <p>{{ day_data['weather'] }}</p>
                <p>Temp High</p>
                <p>Temp Low</p>
                <p>Wind Speed</p>
            </div>
        </div>
    {% endif %}

</body>
<script>

    var clear_button = document.getElementById("form-clear");
    clear_button.onclick = function(){
        var form = document.getElementById("myForm");
        form.reset();
        return false
    }

    var checkbox = document.querySelector("input[name=location]");
    checkbox.addEventListener('change', function() {
        if (this.checked) {
            var form = document.getElementById("myForm");
            form.reset();
            
            document.getElementById("street").disabled = true
            document.getElementById("city").disabled = true
            document.getElementById("state").disabled = true

            var result = loadDoc();
            checkbox.value = result;
            this.checked = true;
        }
    });

    function getDayData(date){

        var weather = '{{weather_forecast_obj | safe}}';

        data={
            Date: date,
            allWeather: weather
        };

        $.ajax({
            type: "POST",
            url: "/result/today",
            data: JSON.stringify(data),
            contentType: "application/json",
            dataType: 'json',
            success: function(data, textStatus, jqXHR){
                // console.log(data);
            },
            error: function(jqXHR, textStatus, errorThrown){
                    // console.log(errorThrown);
            }
        });

    }

    function loadDoc() {
        var xhttp = new XMLHttpRequest();
        xhttp.open("GET", "https://ipinfo.io/?token=7b9f26075b4daa", false);
        xhttp.send();
        return xhttp.responseText;
    }

</script>
</html>



<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>

    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <script src="https://code.highcharts.com/modules/windbarb.js"></script>
    <script src="https://code.highcharts.com/modules/pattern-fill.js"></script>

    <title>Weather Application</title>
</head>
<body>
    <div class="weather-card">
        <div class="weather-card-title">
            <h2>Weather Search</h2>
            <h3>Fill out the form to get weather info !</h3>
        </div>
        <div class="weather-card-form">
            <form onsubmit="return getWeatherInfo()" id="myForm">
                <label for="street" class="required" style="color:rgb(31 84 213)">Street</label>
                <br>
                <input type="text" id="street" name="street" placeholder="Enter Street" required size="50">
                <br>
                <div class="weather-card-form-address weather-card-form-padding-in-between">
                    <div>
                        <label for="city" class="required" style="color:rgb(31 84 213)">City</label>
                        <br>
                        <input type="text" id="city" name="city" placeholder="Enter City" required size="25">
                    </div>
                    <div>
                        <label for="state" class="required" style="color:rgb(31 84 213)">State</label>
                        <br>
                        <select required name="state" id="state">
                            <option disabled selected value> Select State</option>
                            <option value="AL">Alabama</option>
                            <option value="AK">Alaska</option>
                            <option value="AZ">Arizona</option>
                            <option value="AR">Arkansas</option>
                            <option value="CA">California</option>
                            <option value="CO">Colorado</option>
                            <option value="CT">Connecticut</option>
                            <option value="DE">Delaware</option>
                            <option value="DC">District Of Columbia</option>
                            <option value="FL">Florida</option>
                            <option value="GA">Georgia</option>
                            <option value="HI">Hawaii</option>
                            <option value="ID">Idaho</option>
                            <option value="IL">Illinois</option>
                            <option value="IN">Indiana</option>
                            <option value="IA">Iowa</option>
                            <option value="KS">Kansas</option>
                            <option value="KY">Kentucky</option>
                            <option value="LA">Louisiana</option>
                            <option value="ME">Maine</option>
                            <option value="MD">Maryland</option>
                            <option value="MA">Massachusetts</option>
                            <option value="MI">Michigan</option>
                            <option value="MN">Minnesota</option>
                            <option value="MS">Mississippi</option>
                            <option value="MO">Missouri</option>
                            <option value="MT">Montana</option>
                            <option value="NE">Nebraska</option>
                            <option value="NV">Nevada</option>
                            <option value="NH">New Hampshire</option>
                            <option value="NJ">New Jersey</option>
                            <option value="NM">New Mexico</option>
                            <option value="NY">New York</option>
                            <option value="NC">North Carolina</option>
                            <option value="ND">North Dakota</option>
                            <option value="OH">Ohio</option>
                            <option value="OK">Oklahoma</option>
                            <option value="OR">Oregon</option>
                            <option value="PA">Pennsylvania</option>
                            <option value="RI">Rhode Island</option>
                            <option value="SC">South Carolina</option>
                            <option value="SD">South Dakota</option>
                            <option value="TN">Tennessee</option>
                            <option value="TX">Texas</option>
                            <option value="UT">Utah</option>
                            <option value="VT">Vermont</option>
                            <option value="VA">Virginia</option>
                            <option value="WA">Washington</option>
                            <option value="WV">West Virginia</option>
                            <option value="WI">Wisconsin</option>
                            <option value="WY">Wyoming</option>
                        </select>
                    </div>
                </div>
                <hr style="margin-top: 5%;margin-bottom: 5%;border-color:rgb(31 84 213);">
                <div style="display:flex">
                    <span style="color:rgb(31 84 213)">Want us to auto-detect your location? Check here</span>
                    <input type="checkbox" id="location" value="location" name="location">
                </div>
                <div class="weather-card-form-padding-in-between">
                    <button type="submit" style="background-color: rgb(49 86 177); color: white;height: 35px;border: 0px;">SUBMIT</button>
                    <button id="form-clear" style="background-color: #ffbd16;color: white;height: 35px;border: 0px;">CLEAR</button>
                </div>
            </form>
        </div>
    </div>

    <div class="card" id="cardDetails"></div>

    <div id="cardDetailsForecast" style=" display:flex;justify-content: center;"></div>

    <div id="currentWeatherData"></div>

    <div id="charts">
        <figure class="highcharts-figure">
            <div id="container"></div>
        </figure>
    </div>

</body>
<script>

// reset form fields => clear form fields. 
    var clear_button = document.getElementById("form-clear");
    clear_button.onclick = function(){
        var form = document.getElementById("myForm");
        form.reset();
        return false
    }

// checkbox to detect current location
    var checkbox = document.querySelector("input[name=location]");
    checkbox.addEventListener('change', function() {
        if (this.checked) {
            var form = document.getElementById("myForm");
            form.reset();
            
            document.getElementById("street").disabled = true
            document.getElementById("city").disabled = true
            document.getElementById("state").disabled = true

            var result = loadDoc();
            checkbox.value = result;
            this.checked = true;
        }
    });

    function loadDoc() {
        var xhttp = new XMLHttpRequest();
        xhttp.open("GET", "https://ipinfo.io/?token=7b9f26075b4daa", false);
        xhttp.send();
        return xhttp.responseText;
    }

    function getWeatherInfo() {
        var locationCheck = document.getElementById('location');
        if(locationCheck.checked){
            var location = JSON.parse(locationCheck.value);
            coord = location['loc']
            lat = coord.split(",")[0];
            lon = coord.split(",")[1];
            city = location['city'];
            country = location['country'];
            postal = location['postal'];
            region = location['region'];
            address = city + ' ' + region + ' ' + country + ' ' + postal;
            url = `http://localhost:5000/fetch_weather_data_using_current_location?lat=${lat}&lon=${lon}&address=${address}`;
            var req = new XMLHttpRequest();
            req.addEventListener("load", processWeatherDataCurrentLocation);
            req.open("GET", url);
            req.setRequestHeader('Access-Control-Allow-Headers', '*');
            req.setRequestHeader('Content-type', 'application/ecmascript');
            req.setRequestHeader('Access-Control-Allow-Origin', '*');
            req.send();
        }else{
            var street = document.getElementById('street');
            var city = document.getElementById('city');
            var state = document.getElementById('state');
            url = `http://localhost:5000/fetch_weather_data?street=${street.value}&city=${city.value}&state=${state.value}`;
            var req = new XMLHttpRequest();
            req.addEventListener("load", processWeatherData);
            req.open("GET", url);
            req.setRequestHeader('Access-Control-Allow-Headers', '*');
            req.setRequestHeader('Content-type', 'application/ecmascript');
            req.setRequestHeader('Access-Control-Allow-Origin', '*');
            req.send();
        }
        return false;
    }

    function processWeatherDataCurrentLocation(req){
        var response = JSON.parse(this.responseText);
        console.log(response);
        currentWeatherData(response['current'],response['address'],response['weather_codes']);
    }

    function processWeatherData(req){
        var response = JSON.parse(this.responseText);
        console.log(response);
        currentWeatherData(response['current'],response['address'],response['weather_codes']);
        forecastData(response['forecast'],response['weather_codes'],response['hourly']);
    }

    function currentWeatherData(current,address,weather_codes){
        var div = document.createElement('div');
        div.innerHTML = `
            <div class="container" style="color: grey;font-size: 20px;">
                    <p style="justify-content: flex-start;">${address}</p>
                    <div style="display: flex;justify-content: space-between;">
                        <div class="current-weather-details" style="align-items: center;width: 30%;">
                            <img src = "../static/Images/${weather_codes[current[0]['values']['weatherCode']][1]}" style="width: 65%; height: 65%;"/>
                            <p>${weather_codes[current[0]['values']['weatherCode']][0]}</p>
                        </div>
                        <div style="width: 100%;display: flex;justify-content: center;align-items: center;font-size: 50px;color: grey;">
                            <p style="font-size: 80px;justify-content: flex-end;margin: 0%;margin-right: 20px;margin-bottom: 30px;">
                                ${current[0]['values']['temperature']}
                                <span>&#176;</span>
                            </p>
                        </div>
                    </div>
                    <div style="display: flex;">
                        <div class="current-weather-details">
                            <p>Humidity</p>
                            <img src="https://cdn2.iconfinder.com/data/icons/weather-74/24/weather-16-512.png" alt="Humidity" />
                            <p>${current[0]['values']['humidity']}</p>
                        </div>
                        <div class="current-weather-details">
                            <p>Pressure</p>
                            <img src="https://cdn2.iconfinder.com/data/icons/weather-74/24/weather-25-512.png" alt="Pressure">
                            <p>${current[0]['values']['pressure']}</p>
                        </div>
                        <div class="current-weather-details">
                            <p>Wind Speed</p>
                            <img src="https://cdn2.iconfinder.com/data/icons/weather-74/24/weather-27-512.png" alt="Wind Speed">
                            <p>${current[0]['values']['windSpeed']}</p>
                        </div>
                        <div class="current-weather-details">
                            <p>Visibility</p>
                            <img src="https://cdn2.iconfinder.com/data/icons/weather-74/24/weather-30-512.png" alt="Visibility">
                            <p>${current[0]['values']['visibility']}</p>
                        </div>
                        <div class="current-weather-details">
                            <p>Cloud Cover</p>
                            <img src="https://cdn2.iconfinder.com/data/icons/weather-74/24/weather-28-512.png" alt="Cloud Cover">
                            <p>${current[0]['values']['cloudCover']}</p>
                        </div>
                        <div class="current-weather-details">
                            <p>UV Level</p>
                            <img src="https://cdn2.iconfinder.com/data/icons/weather-74/24/weather-24-512.png" alt="UV Level">
                            <p>${current[0]['values']['uvIndex']}</p>
                        </div>
                    </div>
            </div>
        `;
        document.getElementById('cardDetails').appendChild(div);
    }

    function forecastData(forecast,weather_codes,weatherCharts){
        forecastData = forecast;
        weatherCodes = weather_codes;
        charts = weatherCharts
        var div = document.createElement('div');
        div.innerHTML = `
            <div class="card" style='margin-top: 2%; background-color: rgb(79 110 172);width: 55vw'>
                <div class="container weather-forecast-card">
                    <p style="flex: 4;">Date</p>
                    <p style="flex: 3;">Status</p>
                    <p>Temp High</p>
                    <p>Temp Low</p>
                    <p>Wind Speed</p>
                </div>
            </div>`
        for(let i=0;i<forecast.length;i++){
            div.innerHTML += `
                <div class="card" style="margin-top: 0.75%; width: 55vw;" onclick="dayData(${i},forecastData,weatherCodes,charts)">
                    <div class="container weather-forecast-card">
                        <div style="flex: 8;">${forecast[i]['Date']}</div>
                        <div style="flex: 3;">
                            <img src = "../static/Images/${weather_codes[forecast[i]['values']['weatherCode']][1]}" style="width: 50px; height: 50px;"/>
                            <span>${weather_codes[forecast[i]['values']['weatherCode']][0]}</span>
                        </div>
                        <div style="flex: 2;">${forecast[i]['values']['temperatureMax']}</div>
                        <div style="flex: 2;">${forecast[i]['values']['temperatureMin']}</div>
                        <div style="flex: 2;">${forecast[i]['values']['windSpeed']}</div>
                    </div>
                </div>
            `
        }
        document.getElementById('cardDetailsForecast').appendChild(div);
    }

    function dayData(i,weather,weather_codes,weatherCharts){

        charts = weatherCharts
        var presentDay = document.getElementById('cardDetails');
        var forecastList = document.getElementById('cardDetailsForecast');

        presentDay.style.display = "none";
        forecastList.style.display = "none";

        var div = document.createElement('div');
        div.innerHTML = `
            <div class="daily-weather-card">
            <div class="header">
                <div class="left">
                <div class="date">${weather[i].Date}</div>
                <div class="weather-type">${weather_codes[weather[i]['values']['weatherCode']][0]}</div>
                <div class="min-max">${weather[i]['values']['temperatureMax']}˚F/${weather[i]['values']['temperatureMin']}˚F</div>
                </div>
                <div class="right">
                <img class="weather-type-icon" src="../static/Images/${weather_codes[weather[i]['values']['weatherCode']][1]}" alt="" />
                </div>
            </div>
            <div class="body">
                <table>
                <tr>
                    <td class="key">Precipitation:</td>
                    <td class="value">${weather[i]['values']['precipitationType']}</td>
                </tr>
                <tr>
                    <td class="key">Chance of Rain:</td>
                    <td class="value">${weather[i]['values']['precipitationProbability']}</td>
                </tr>
                <tr>
                    <td class="key">Wind Speed:</td>
                    <td class="value">${weather[i]['values']['windSpeed']} mph</td>
                </tr>
                <tr>
                    <td class="key">Humidity:</td>
                    <td class="value">${weather[i]['values']['humidity']}%</td>
                </tr>
                <tr>
                    <td class="key">Visibility:</td>
                    <td class="value">${weather[i]['values']['visibility']} mi</td>
                </tr>
                <tr>
                    <td class="key">Sunrise/Sunset:</td>
                    <td class="value">${weather[i]['values']['sunriseTime']}AM/${weather[i]['values']['sunsetTime']}PM</td>
                </tr>
                </table>
            </div>
        </div>

        <br>

        <h3 onClick="displayCharts(charts)"">Charts</h3>
    `
    document.getElementById('currentWeatherData').appendChild(div);
    }

    function displayCharts(data){
        arr=[]
        for(var i=0;i<data.length;i++){
            newArr = [];
            newArr.push(data[i].startTime);
            newArr.push(data[i]['values']['temperatureMax']);
            newArr.push(data[i]['values']['temperatureMin']);
            arr.push(newArr);
        }

        var div = document.createElement('div');
        Highcharts.chart('container', {

            chart: {
                type: 'arearange',
                zoomType: 'x',
                scrollablePlotArea: {
                    minWidth: 600,
                    scrollPositionX: 1
                }
            },

            title: {
                text: 'Temperature variation by day'
            },

            xAxis: {
                type: 'datetime',
                accessibility: {
                    rangeDescription: 'Range: Jan 1st 2017 to Dec 31 2017.'
                }
            },

            yAxis: {
                title: {
                    text: null
                }
            },

            tooltip: {
                crosshairs: true,
                shared: true,
                valueSuffix: '°C',
                xDateFormat: '%A, %b %e'
            },

            legend: {
                enabled: false
            },

            series: [{
                name: 'Temperatures',
                data: arr
            }]

        });
    }

</script>
</html>